(function(t,e){var n=e.body,s=e.querySelector.bind(e),o=e.querySelectorAll.bind(e),a=s("html"),l=s("#gotop"),c=s("#menu"),r=s("#header"),d=s("#mask"),h=s("#menu-toggle"),f=s("#menu-off"),u=s("#loading"),v=t.requestAnimationFrame,m=12,g=Array.prototype.forEach,L="ontouchstart"in t&&/Mobile|Android|iOS|iPhone|iPad|iPod|Windows Phone|KFAPWI/i.test(navigator.userAgent)?"touchstart":"click",p=/micromessenger/i.test(navigator.userAgent),x=function(){},y=function(t){var e=t.offsetLeft,i=t.offsetTop;if(t.offsetParent){var n=arguments.callee(t.offsetParent);e+=n.x,i+=n.y}return{x:e,y:i}},w=navigator.userAgent.indexOf("Firefox")!==-1?e.documentElement:n,$={goTop:function(t){var e=w.scrollTop,i=arguments.length>2?arguments[1]:Math.abs(e-t)/m;e&&e>t?(w.scrollTop=Math.max(e-i,0),v(arguments.callee.bind(this,t,i))):t&&e<t?(w.scrollTop=Math.min(e+i,t),v(arguments.callee.bind(this,t,i))):this.toc.actived(t)},toggleGotop:function(e){e>t.innerHeight/2?l.classList.add("in"):l.classList.remove("in")},toggleMenu:function(e){var i=s("#main");if(e){if(c.classList.remove("hide"),t.innerWidth<1241)if(d.classList.add("in"),c.classList.add("show"),p){var n=w.scrollTop;i.classList.add("lock"),i.scrollTop=n}else a.classList.add("lock")}else if(c.classList.remove("show"),d.classList.remove("in"),p){var n=i.scrollTop;i.classList.remove("lock"),w.scrollTop=n}else a.classList.remove("lock")},fixedHeader:function(t){t>r.clientHeight?r.classList.add("fixed"):r.classList.remove("fixed")},toc:function(){var t=s("#post-toc");if(!t||!t.children.length)return{fixed:x,actived:x};var e=y(t),n=e.y,a=r.clientHeight,l=s("#post-content").querySelectorAll("h1, h2, h3, h4, h5, h6");return t.querySelector('a[href="#'+l[0].id+'"]').parentNode.classList.add("active"),g.call(o('a[href^="#"]'),function(t){t.addEventListener("click",function(t){t.preventDefault();var e=y(s('[id="'+decodeURIComponent(this.hash).substr(1)+'"]')).y-a;v($.goTop.bind($,e))})}),{fixed:function(e){e>n-a?t.classList.add("fixed"):t.classList.remove("fixed")},actived:function(e){for(i=0,len=l.length;i<len;i++)if(e>y(l[i]).y-a-5){t.querySelector("li.active").classList.remove("active");var n=t.querySelector('a[href="#'+l[i].id+'"]').parentNode;n.classList.add("active")}e<y(l[0]).y&&(t.querySelector("li.active").classList.remove("active"),t.querySelector('a[href="#'+l[0].id+'"]').parentNode.classList.add("active"))}}}(),hideOnMask:[],modal:function(t){this.$modal=s(t),this.$off=this.$modal.querySelector(".close");var e=this;this.show=function(){d.classList.add("in"),e.$modal.classList.add("ready"),setTimeout(function(){e.$modal.classList.add("in")},0)},this.onHide=x,this.hide=function(){e.onHide(),d.classList.remove("in"),e.$modal.classList.remove("in"),setTimeout(function(){e.$modal.classList.remove("ready")},300)},this.toggle=function(){return e.$modal.classList.contains("in")?e.hide():e.show()},$.hideOnMask.push(this.hide),this.$off&&this.$off.addEventListener(L,this.hide)},share:function(){var t=s("#pageShare"),i=s("#shareFab"),n=new this.modal("#globalShare");s("#menuShare").addEventListener(L,n.toggle),i&&(i.addEventListener(L,function(){t.classList.toggle("in")},!1),e.addEventListener(L,function(e){!i.contains(e.target)&&t.classList.remove("in")},!1));var a=new this.modal("#wxShare");a.onHide=n.hide,g.call(o(".wxFab"),function(t){t.addEventListener(L,a.toggle)})},search:function(){function t(){e.classList.toggle("in")}var e=s("#search-wrap");s("#search").addEventListener(L,t)},reward:function(){var t=new this.modal("#reward");s("#rewardBtn").addEventListener(L,t.toggle)},fixNavMinH:function(){function t(){e.style.minHeight=e.parentNode.clientHeight-e.nextElementSibling.offsetHeight+"px"}var e=s(".nav");return t}(),waterfall:function(){t.innerWidth<760||g.call(o(".waterfall"),function(t){var e=t.querySelectorAll(".waterfall-item"),i=[0,0];g.call(e,function(t){var e=i[0]<=i[1]?0:1;t.style.cssText="top:"+i[e]+"px;left:"+(e>0?"50%":0),i[e]+=t.offsetHeight}),t.style.height=Math.max(i[0],i[1])+"px",t.classList.add("in")})},tabBar:function(t){t.parentNode.parentNode.classList.toggle("expand")},page:function(){var t=o(".fade, .fade-scale");return{loaded:function(){g.call(t,function(t){t.classList.add("in")})},unload:function(){g.call(t,function(t){t.classList.remove("in")})}}}(),lightbox:function(){function i(i){this.$img=i.querySelector("img"),this.$overlay=i.querySelector("overlay"),this.margin=40,this.title=this.$img.title||this.$img.alt||"",this.isZoom=!1;var n,s,o,a=this.$img.naturalWidth||this.$img.width,l=this.$img.naturalHeight||this.$img.height;this.calcRect=function(){s=w.clientWidth,o=w.clientHeight;var t=o-2*this.margin,e=a,i=l,c=(this.margin,e>s?s/e:1),r=i>t?t/i:1,d=Math.min(c,r);return e*=d,i*=d,{w:e,h:i,t:(o-i)/2-n.top,l:(s-e)/2-n.left+this.$img.offsetLeft}},this.setImgRect=function(t){this.$img.style.cssText="width: "+t.w+"px; max-width: "+t.w+"px; height:"+t.h+"px; top: "+t.t+"px; left: "+t.l+"px"},this.setFrom=function(){this.setImgRect({w:n.width,h:n.height,t:0,l:(i.offsetWidth-n.width)/2})},this.setTo=function(){this.setImgRect(this.calcRect())},this.addTitle=function(){this.title&&(this.$caption=e.createElement("div"),this.$caption.innerHTML=this.title,this.$caption.className="overlay-title",i.appendChild(this.$caption))},this.removeTitle=function(){this.$caption&&i.removeChild(this.$caption)};var c=this;this.zoomIn=function(){n=this.$img.getBoundingClientRect(),i.style.height=n.height+"px",i.classList.add("ready"),this.setFrom(),this.addTitle(),this.$img.classList.add("zoom-in"),setTimeout(function(){i.classList.add("active"),c.setTo(),c.isZoom=!0},0)},this.zoomOut=function(){this.isZoom=!1,i.classList.remove("active"),this.$img.classList.add("zoom-in"),this.setFrom(),setTimeout(function(){c.$img.classList.remove("zoom-in"),c.$img.style.cssText="",c.removeTitle(),i.classList.remove("ready"),i.removeAttribute("style")},300)},i.addEventListener("click",function(t){c.isZoom?c.zoomOut():"IMG"===t.target.tagName&&c.zoomIn()}),e.addEventListener("scroll",function(){c.isZoom&&c.zoomOut()}),t.addEventListener("resize",function(){c.isZoom&&c.zoomOut()})}g.call(o(".img-lightbox"),function(t){new i(t)})}()};t.addEventListener("load",function(){$.fixNavMinH(),$.waterfall();var t=w.scrollTop;$.toc.fixed(t),$.toc.actived(t),u.classList.remove("active"),$.page.loaded()}),t.addEventListener("beforeunload",function(){$.page.unload()}),t.addEventListener("resize",function(){t.BLOG.even=L="ontouchstart"in t?"touchstart":"click",$.fixNavMinH(),$.toggleMenu(),$.waterfall()}),l.addEventListener(L,function(){v($.goTop.bind($,0))},!1),h.addEventListener(L,function(t){$.toggleMenu(!0),t.preventDefault()},!1),f.addEventListener(L,function(){c.classList.add("hide")},!1),d.addEventListener(L,function(t){$.toggleMenu(),$.hideOnMask.forEach(function(t){t()}),t.preventDefault()},!1),e.addEventListener("scroll",function(){var t=w.scrollTop;$.toggleGotop(t),$.fixedHeader(t),$.toc.fixed(t),$.toc.actived(t)},!1),t.BLOG.SHARE&&$.share(),t.BLOG.REWARD&&$.reward(),$.docEl=w,$.noop=x,$.even=L,$.$=s,$.$$=o,Object.keys($).reduce(function(t,e){return t[e]=$[e],t},t.BLOG),Waves.init(),Waves.attach(".global-share li",["waves-block"]),Waves.attach(".article-tag-list-link, #page-nav a, #page-nav span",["waves-button"])})(window,document);